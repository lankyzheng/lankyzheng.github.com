<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[wannaCOOL.com]]></title>
  <link href="http://lankyzheng.github.com/atom.xml" rel="self"/>
  <link href="http://lankyzheng.github.com/"/>
  <updated>2013-01-21T06:51:02+00:00</updated>
  <id>http://lankyzheng.github.com/</id>
  <author>
    <name><![CDATA[lankyzheng]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[上海合法兑换新台币攻略-2012元旦版]]></title>
    <link href="http://lankyzheng.github.com/blog/2012/01/13/shanghaitaibi/"/>
    <updated>2012-01-13T13:31:00+00:00</updated>
    <id>http://lankyzheng.github.com/blog/2012/01/13/shanghaitaibi</id>
    <content type="html"><![CDATA[<p><img src="http://pic.yupoo.com/lankyzheng/CzhWAgqp/5hbWb.png" title="banner" alt="banner" /></p>

<!--more-->


<p>最近老妈要去台湾旅游，叫我给她换点新台币。记得两年前，我去台湾之前，特意去中国银行问过兑换新台币的事情，当时一个面目狰狞的女营业员一脸鄙视的告诉我，“中国大陆没有银行能换台币的！” 时过境迁，那现在情况究竟如何呢？？？</p>

<h1>网上搜索</h1>

<p>这次我专门先在网上搜索了一下，找到2个关键信息。</p>

<p>2010年4月27日，东方早报新闻<a href="http://epaper.dfdaily.com/dfzb/html/2010-04/27/content_235097.htm">《交行在沪启动新台币双向兑换》</a></p>

<p>2010年5月13日，东方早报新闻<a href="http://epaper.dfdaily.com/dfzb/html/2010-05/13/content_245765.htm">《四银行获准在沪开办新台币兑换业务》</a></p>

<p>可见，2010年世博期间，为了方便对岸同胞来参观世博，上海有4家银行是允许双向兑换新台币。但是，世博结束1年多了，不知道目前的情况如何。</p>

<h1>电话咨询</h1>

<p>我给交行客服热线95559打了个电话，询问上海目前是否还保留这项兑换业务。接电话的MM果然不清楚，但是态度很好，让我别挂她去问后台，在等待了几分钟之后，给我的答复是：</p>

<ol>
<li>目前这项业务应该是还可以的；</li>
<li>不是每个营业点都可以，MM热心的帮我查询了长宁区和浦东新区的两个能兑换的营业点；</li>
<li>即使能兑换的营业点，也不保证有足够的新台币供兑换，最好去之前电话询问预约好，MM又热心的查询了营业点电话给我。</li>
</ol>


<p>之后，我电话长宁区江苏路交通银行网点，果然，只有大概1万新台币，而且基本上都是1000元面值。不过对我也OK了。</p>

<h1>实际兑换</h1>

<p>接下来就趁中午午休时间，直接杀过去了！到了交行，领了号，兑换外币属于个人业务，等的时间真漫长啊！过程中还有一点要注意，兑换需要使用人民币现金，或者本行银行卡。我没有交行的银行卡，只好趁等叫号的时间，在ATM排队取了现金。</p>

<p>最后，顺利拿到1万新台币，9张1000元，10张100元。付出人民币2165元！具体汇率大家自己算吧，我看了水单，貌似人民币和新台币没有官方直接汇率，都是通过美元转换的。</p>

<h6>EOF</h6>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[盛大云主机的unixbench测试报告]]></title>
    <link href="http://lankyzheng.github.com/blog/2011/11/17/sndaunixbench/"/>
    <updated>2011-11-17T07:59:00+00:00</updated>
    <id>http://lankyzheng.github.com/blog/2011/11/17/sndaunixbench</id>
    <content type="html"><![CDATA[<p><img src="http://pic.yupoo.com/lankyzheng/Czi1S8jy/P2iSG.jpg" title="banner" alt="banner" /></p>

<!--more-->


<p>盛大云主机，默认送了100块钱，选了最小配置的那个，40几块包月，以为能用2个月，结果发现IP地址每天要收1块钱，坑爹啊！难道还有人用vps不用公网IP的吗？？？！！！</p>

<p>用unixbench跑了一把，结果大家看吧！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>#    #  #    #  #  #    #          #####   ######  #    #   ####   #    #
</span><span class='line'>#    #  ##   #  #   #  #           #    #  #       ##   #  #    #  #    #
</span><span class='line'>#    #  # #  #  #    ##            #####   #####   # #  #  #       ######
</span><span class='line'>#    #  #  # #  #    ##            #    #  #       #  # #  #       #    #
</span><span class='line'>#    #  #   ##  #   #  #           #    #  #       #   ##  #    #  #    #
</span><span class='line'> ####   #    #  #  #    #          #####   ######  #    #   ####   #    #
</span><span class='line'>
</span><span class='line'>Version 5.1.3                      Based on the Byte Magazine Unix Benchmark
</span><span class='line'>
</span><span class='line'>Multi-CPU version                  Version 5 revisions by Ian Smith,
</span><span class='line'>Sunnyvale, CA, USA
</span><span class='line'>January 13, 2011                   johantheghost at yahoo period com
</span><span class='line'>
</span><span class='line'>1 x Dhrystone 2 using register variables  1 2 3 4 5 6 7 8 9 10
</span><span class='line'>
</span><span class='line'>1 x Double-Precision Whetstone  1 2 3 4 5 6 7 8 9 10
</span><span class='line'>
</span><span class='line'>1 x Execl Throughput  1 2 3
</span><span class='line'>
</span><span class='line'>1 x File Copy 1024 bufsize 2000 maxblocks  1 2 3
</span><span class='line'>
</span><span class='line'>1 x File Copy 256 bufsize 500 maxblocks  1 2 3
</span><span class='line'>
</span><span class='line'>1 x File Copy 4096 bufsize 8000 maxblocks  1 2 3
</span><span class='line'>
</span><span class='line'>1 x Pipe Throughput  1 2 3 4 5 6 7 8 9 10
</span><span class='line'>
</span><span class='line'>1 x Pipe-based Context Switching  1 2 3 4 5 6 7 8 9 10
</span><span class='line'>
</span><span class='line'>1 x Process Creation  1 2 3
</span><span class='line'>
</span><span class='line'>1 x System Call Overhead  1 2 3 4 5 6 7 8 9 10
</span><span class='line'>
</span><span class='line'>1 x Shell Scripts (1 concurrent)  1 2 3
</span><span class='line'>
</span><span class='line'>1 x Shell Scripts (8 concurrent)  1 2 3
</span><span class='line'>
</span><span class='line'>========================================================================
</span><span class='line'>BYTE UNIX Benchmarks (Version 5.1.3)
</span><span class='line'>
</span><span class='line'>System: localhost.localdomain: GNU/Linux
</span><span class='line'>OS: GNU/Linux — 2.6.18-274.el5xen — #1 SMP Fri Jul 22 06:14:51 EDT 2011
</span><span class='line'>Machine: i686 (i386)
</span><span class='line'>Language: en_US.utf8 (charmap=”UTF-8″, collate=”UTF-8″)
</span><span class='line'>CPU 0: AMD Opteron(tm) Processor 6172 (5253.6 bogomips)
</span><span class='line'>Hyper-Threading, MMX, AMD MMX, Physical Address Ext, SYSCALL/SYSRET
</span><span class='line'>17:54:15 up 2 days, 23:48,  1 user,  load average: 0.02, 0.01, 0.00; runlevel 3
</span><span class='line'>
</span><span class='line'>————————————————————————
</span><span class='line'>Benchmark Run: 四 11月 17 2011 17:54:15 – 18:22:09
</span><span class='line'>1 CPU in system; running 1 parallel copy of tests
</span><span class='line'>
</span><span class='line'>Dhrystone 2 using register variables        6316364.6 lps   (10.0 s, 7 samples)
</span><span class='line'>Double-Precision Whetstone                     1561.1 MWIPS (10.0 s, 7 samples)
</span><span class='line'>Execl Throughput                               1730.2 lps   (30.0 s, 2 samples)
</span><span class='line'>File Copy 1024 bufsize 2000 maxblocks        396524.4 KBps  (30.0 s, 2 samples)
</span><span class='line'>File Copy 256 bufsize 500 maxblocks          124786.0 KBps  (30.0 s, 2 samples)
</span><span class='line'>File Copy 4096 bufsize 8000 maxblocks        728175.7 KBps  (30.0 s, 2 samples)
</span><span class='line'>Pipe Throughput                              800622.9 lps   (10.0 s, 7 samples)
</span><span class='line'>Pipe-based Context Switching                  90301.6 lps   (10.0 s, 7 samples)
</span><span class='line'>Process Creation                               2931.9 lps   (30.0 s, 2 samples)
</span><span class='line'>Shell Scripts (1 concurrent)                   2687.7 lpm   (60.0 s, 2 samples)
</span><span class='line'>Shell Scripts (8 concurrent)                    370.7 lpm   (60.1 s, 2 samples)
</span><span class='line'>System Call Overhead                         721836.9 lps   (10.0 s, 7 samples)
</span><span class='line'>
</span><span class='line'>System Benchmarks Index Values               BASELINE       RESULT    INDEX
</span><span class='line'>Dhrystone 2 using register variables         116700.0    6316364.6    541.2
</span><span class='line'>Double-Precision Whetstone                       55.0       1561.1    283.8
</span><span class='line'>Execl Throughput                                 43.0       1730.2    402.4
</span><span class='line'>File Copy 1024 bufsize 2000 maxblocks          3960.0     396524.4   1001.3
</span><span class='line'>File Copy 256 bufsize 500 maxblocks            1655.0     124786.0    754.0
</span><span class='line'>File Copy 4096 bufsize 8000 maxblocks          5800.0     728175.7   1255.5
</span><span class='line'>Pipe Throughput                               12440.0     800622.9    643.6
</span><span class='line'>Pipe-based Context Switching                   4000.0      90301.6    225.8
</span><span class='line'>Process Creation                                126.0       2931.9    232.7
</span><span class='line'>Shell Scripts (1 concurrent)                     42.4       2687.7    633.9
</span><span class='line'>Shell Scripts (8 concurrent)                      6.0        370.7    617.9
</span><span class='line'>System Call Overhead                          15000.0     721836.9    481.2
</span><span class='line'>========
</span><span class='line'>System Benchmarks Index Score                                         518.0
</span></code></pre></td></tr></table></div></figure>


<h6>EOF</h6>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[中英对照] Security Issues in Android Custom ROMs：定制ROM的安全问题]]></title>
    <link href="http://lankyzheng.github.com/blog/2011/10/19/security-issues-in-android-custom-roms/"/>
    <updated>2011-10-19T06:25:00+00:00</updated>
    <id>http://lankyzheng.github.com/blog/2011/10/19/security-issues-in-android-custom-roms</id>
    <content type="html"><![CDATA[<p><img src="http://pic.yupoo.com/lankyzheng/Czi9uqZt/JyV3F.png" title="banner" alt="banner" /></p>

<!--more-->


<p>原文连接：<a href="http://anantshri.info/articles/android_cust_rom_security.html">http://anantshri.info/articles/android_cust_rom_security.html</a></p>

<h1>Abstract：摘要</h1>

<p>This paper attempts to look behind the wheels of android and keeping special focus on custom rom’s and basically check for security misconfiguration’s which could yield to device compromise, which may result in malware infection or data theft.</p>

<p>本文试图着眼Android内部并特别关注第定制ROM，初步检查安全方面的错误配置，这些问题可能导致感染恶意软件、数据被盗，致使设备被黑。</p>

<h1>Introduction to Android：介绍</h1>

<p>Android is a software stack for mobile devices such as mobile telephones and tablet computers developed by Google Inc and the Open Handset Alliance. Android consists of a mobile operating system based on the Linux kernel, with middleware, libraries and APIs written in C and application software running on an application framework which includes Java-compatible libraries based on Apache Harmony. Android uses the Dalvik virtual machine with just-in-time compilation to run compiled Java code. – WIKIPEDIA</p>

<p>Android是由Google Inc和Open Handset Alliance开发的一套用于移动电话和平台电脑的软件。包含一个基于Linux kernel的移动操作系统、中间件、用C写的库和API、一套包含基于Apache Harmony的Java兼容库的应用框架、以及运行其上的应用软件。Android使用具有JIT编译器的Dalvik虚拟机来运行已编译的Java代码。</p>

<p>In Simple terms Android is the operating system behind +40% smart phones and 10-20% tablet market. There are various manufacturers backing this OS including the likes of Samsung, Motorola, Sony Ericsson, LG, HTC and many more.</p>

<p>简而言之，Android占据了+40%的智能手机以及10-20%平板的操作系统市场。采用这个OS的厂商众多，例如Samsung、Motorola、Sony Ericsson、HTC等等。</p>

<p>Based on Linux kernel large part of the android source code is available in public space (except few google specific products and honeycomb or 3.X series ). This provides the unique opportunity for one and all to have a custom phone for him.</p>

<p>由于基于Linux kernel大部分Android的源代码可以公开获得（除了几个google产品、honeycomb或者3.X系列）。这个独特的机会使得大家都可以可以搞一个定制化的手机。</p>

<h1>What is Android ROM：ROM是什么</h1>

<p>Android ROM is the basic OS firmware layer of the Phone. This is the base for phone operations. In file system generally this part is stored under /system. May have /data partition also in case it holds some user specific settings.</p>

<p>Android ROM是电话的基本OS固件。是电话操作的技术。从文件系统看，这部分存放在/system下面，可能还有/data分区用来保存一些特定的用户设置。</p>

<p>This is the portion which contains all quintessential parts of the os for proper functionality of the Phone.</p>

<p>下图包含了用来使电话正常运作的所有典型的组成部分。</p>

<p>Starting with linux kernel along with it modules to Dalvik VM, combined with core libraries and user liberaries (SQLite etc). This same portion also features the application framework which allows for seemless interaction of android applications with android core features, including the telephone.
On top of all this we see the applications running in Dalvik VM.</p>

<p>首先是linux kernel，之上是Dalvik虚拟机、以及核心库和用户库（SQLite等）。这同一部分同时是应用框架，用于应用和android核心功能的无缝交互，包括电话功能。再之上就是跑在Dalvik虚拟机上的应用程序了。</p>

<p><img src="http://anantshri.info/articles/sec_cust/image002.jpg" alt="image01" /></p>

<h1>Types of ROM：ROM的类型</h1>

<p>Android ROM’s can be divided into two basic groups.</p>

<ol>
<li>STOCK ROM: the ROM which comes preinstalled with Phone.</li>
<li>CUSTOM ROM: after market version which could be installed on a phone if the phone is rooted.</li>
</ol>


<p>Android ROM主要两大类：</p>

<ol>
<li>STOCK ROM：就是随电话预装的原厂ROM。</li>
<li>CUSTOM ROM：面市后可以安装在已root的手机上的定制ROM。</li>
</ol>


<p>Stock ROMs generally contains vendor / carrier specific additions in them, where as Custom ROM’s have different motives behind them.</p>

<p>原厂ROM通常包含了厂商和运营商的定制组件，然而定制ROM在这方面的目的则不同。</p>

<p>Some of the most common and widely usable custom rom’s include</p>

<ol>
<li>CyanogenMod: The largest aftermarket firmware compiled from android ASOP and strives to be as close to ASOP code as possible. Source code is publically open.</li>
<li>MIUI: a Chinese version focusing on emulation iPhone looks, source codes are not open.</li>
<li>OMFGB: a customized version of Gingerbread.</li>
</ol>


<p>最常见和广泛应用的定制ROM包括：</p>

<ol>
<li>CyanogenMod：最大的定制固件，编译于android ASOP开源项目并尽力和ASOP保持接近。源代码开放。</li>
<li>MIUI：一个致力于模仿iphone外观的中文版本，源代码不开放。</li>
<li>OMFGB：Gingerbread的一个定制版本。</li>
</ol>


<p>Things to keep in mind are that in order to install a custom rom your phone needs to be rooted and / or boot loader unlocked. As well as a proper recovery should be installed.</p>

<p>需要牢记的的是想要在手机上安装一个定制ROM，必须先rooted或者把boot loader解锁。并安装一个正确的revovery程序。</p>

<h1>Advantages of custom ROM’s:定制的优势</h1>

<p>Stock Rom’s or default OS kit that comes with the phone or carrier or phone manufacturing company is targeted towards a large set of audience and hence is made in a generic fashion. As well as in order to be unique in the market every manufacturer has added his own layer of UI on top of default android UI.</p>

<p>随手机厂商、运营商而来的原厂ROM是面对大多数用户的通用类型。同时为了在市场上显得不同，厂商往往在默认Android的UI基础上加入自己的UI层。</p>

<p>This is where custom ROM comes into picture:
Custom Rom comes with their own share of advantages.</p>

<ol>
<li><p>Bring out the best of all Worlds. Some of the stuff those are actually available in wild.</p>

<ul>
<li><p>You may like Sony Ericsson hardware but love the htc sense ui.</p></li>
<li><p>You don’t like the default applications and prefer a minimalistic phone.</p></li>
<li><p>ROMs with specific features / themes / customization as deemed good.</p></li>
</ul>
</li>
<li><p>Provides update even when manufacturer / carrier stop’s update.</p></li>
<li>Bleeding edge (custom ROMs at this point are generally at 2.3.5 where as stock’s still holding to 2.3.3)</li>
<li>Custom ROMs are pre rooted.</li>
<li>Custom ROMs bring out the customization from CM and MIUI to the stock firmware.</li>
<li>Build for Speed.</li>
<li>Build for gaming.</li>
<li>Over clocking (increase performance), under clocking (increase battery life)</li>
</ol>


<p>Effectively having a custom rom provides you the chance to customize the device to a lot higher level then generally possible.</p>

<p>这样就应运而生了定制ROM：因为定制ROM带来了他们的优点。</p>

<ol>
<li><p>博采众长。其中很多东西已经可以获得：</p>

<ul>
<li><p>比如你喜欢索爱的机器同时又想用HTC的sense界面。</p></li>
<li><p>比如你不喜欢默认的app而喜欢一个最干净的电话。</p></li>
<li><p>认为具备某些定制、主题、自定义的ROM才是好的。</p></li>
</ul>
</li>
<li><p>即使厂商、运营商已经停止更新的情况下仍能获得更新。</p></li>
<li><p>玩尖端（目前定制ROM基本都是2.3.5而厂商ROM还是2.3.3）</p></li>
<li><p>定制ROM都已经rooted</p></li>
<li><p>定制ROM把个性定制从CM和MIUI带到厂商ROM</p></li>
<li><p>为了速度</p></li>
<li><p>为了游戏</p></li>
<li><p>超频（提升性能）降频（提升电池寿命）</p></li>
</ol>


<p>有效的拥有一个定制ROM使得你有机会把手机从通用状态带到更高的玩机程度。</p>

<h1>How to obtain custom ROM’s:怎么获得定制ROM</h1>

<p>There are many ways and means to obtain these custom ROM’s. Some may include visiting the official site and some may include download the ROM’s from various file hosting site where the link is available at various forums. Couple of prominent links listed below.</p>

<p>有很多方式获得定制ROM。包括访问如下网站/论坛会提供各种下载ROM。</p>

<p>• <a href="http://cyanogenmod.com">http://cyanogenmod.com</a></p>

<p>• <a href="http://miui.org">http://miui.org</a></p>

<p>• <a href="http://forum.xda-developers.com">http://forum.xda-developers.com</a></p>

<p>• <a href="http://android.modaco.com">http://android.modaco.com</a></p>

<p>• <a href="http://modmymobile.com/forum.php">http://modmymobile.com/forum.php</a></p>

<p>• And many more underground forums.</p>

<p>还有很多其他地下论坛。</p>

<h1>How are they created:如何制作的？</h1>

<p>Recipe of creating a rom is to follow one of the following practices.</p>

<ol>
<li>Modify the stock ROM and add features to it.</li>
<li>Compile your own android from sources directly ASOP)</li>
<li>Modify Cyanogen or any other open source ROM.</li>
<li>Combine both and work on a custom rom taking parts from stock and ASOP.</li>
</ol>


<p>制作ROM的配方如下：</p>

<ol>
<li>修改原厂ROM加入新特性</li>
<li>直接从ASOP开源项目编译自己的ROM</li>
<li>修改Cyanogen或者其他开源ROM</li>
<li>从原厂ROM和ASOP混合定制一个ROM</li>
</ol>


<p>The people behind ROM cooking are doing this for variety of reasons. Some for fun, others for profit and some just do it coz they can do it.</p>

<p>做ROM的人有各种理由。为了好玩、为了利益以及只是因为有能力做ROM。</p>

<h1>Why do we need a security review：为啥要做一个安全审查</h1>

<p>Android with its huge market share has made ways into the pockets of the corporate giants, and slowly-slowly voices are being raised to incorporate android in corporate infrastructure. With growing sales this demand is only going to increase and in no ways going to diminish. Keeping this in mind lots and lots of research work is going on to find suitable ways and means to incorporate custom ROM’s into corporate infrastructure. One such work is documented here : <a href="https://www.sans.org/reading_room/whitepapers/sysadmin/securely-deploying-android-devices_33799">https://www.sans.org/reading_room/whitepapers/sysadmin/securely-deploying-android-devices_33799</a>. Also with rapid growth in market share we have seen unprecedented growth in worm virus and malware growth in android too.</p>

<p>Keeping all these factors in mind we do seriously need to investigate more on the android custom ROM’s.</p>

<p>由于Android的巨大市场份额使之进入了大企业的“口袋”中，逐渐的有提出把Android整合进企业基础设施。随着销售增长这个需求只会增不会减。大量的研究正在进行以找到合适的方法在企业基础设施整合定制ROM。例如 <a href="https://www.sans.org/reading_room/whitepapers/sysadmin/securely-deploying-android-devices_33799">https://www.sans.org/reading_room/whitepapers/sysadmin/securely-deploying-android-devices_33799</a>。同时随着市场的快速增长，我们看到Android上蠕虫、病毒和恶意软件的空前增加。</p>

<p>基于上述因素我们需要认真研究android的定制ROM。</p>

<h1>Practices under Scrutiny：详细检查后后动手</h1>

<p>This paper is an effort in directions of looking at security misconfigurations that can happen. Some of the stuff is already present in current ROM; others might be hypothetical but seriously exploitable. We are focusing basically on the core layer of android, I will be detailing about various settings and configurations which might result in a total security breach of android device.</p>

<p>本文试图关注那些可能发生的安全错误配置。其中一部分已经在当前ROM中存在；其他可能属于假设但也是严重的漏洞。我们基本上关注anddroid的核心层，会详述各种可能导致安全危害的设置和配置。</p>

<h2>USB Debugging enabled：开启USB调试</h2>

<p>USB debugging or ADB is Google’s method for debugging support this is the setting which needs to be enabled when you are doing development or debugging of application, however there is no need to keep this setting enabled when its a normal user system.ADB Bridge supports push and pull of files and folders from all the directories where adb user have access.</p>

<p>USB调试/ADB是google提供的debug工具以便在开发和调试应用时开启，但是没有必要在一个普通用户的系统上打开。ADB Bridge支持所有具有adb用户权限的文件和文件夹的推拉。</p>

<p>Adb has various options which allows many more features including</p>

<ul>
<li>Logcat collection</li>
<li>Installation of software</li>
<li>Remount of system partition with rw</li>
</ul>


<p>Adb also allows for fastboot which in turn allows a user to run non verified or unofficial kernel without even overwriting the stock data.</p>

<p>ADB有大量选项允许如下更多特性：</p>

<ul>
<li>日志收集</li>
<li>软件安装</li>
<li>以RW读写权限重新加载文件系统</li>
</ul>


<p>ADB也允许fastboot操作，允许在不改写原厂数据的情况下运行未经验证非官方kernel。</p>

<p>This setting is available in android machine in following place</p>

<p>该设置在android机器的如下位置：</p>

<pre><code>Menu → Settings → Applications → Development
</code></pre>

<p><img src="http://anantshri.info/articles/sec_cust/image004.jpg" alt="image02" /></p>

<p>This options should be kept enabled only when you are a constant developer or you keep your handset connected to pc all the time. However this must be turned off before connecting to any non trusted machine.</p>

<p>这个选项只有当你是一个长期的开发人员或者始终将手机和pc连接时才应该打开。但当连接到任何非信任机器时都应该关闭。</p>

<h2>Adb Shell root mode：Adb Shell root模式</h2>

<p>This is one of the most dangerous setting of all. This setting allows adb shell to connect in root user mode. Effectively giving a root shell to whosoever gets usb connection to phone. Another tricky point about this setting is its activated only at boot time and during whole period of working the variable can’t be changed.</p>

<p>这是最危险的设置之一。允许adb shell连接到root用户模式。只要有USB连接到电话就可以得到一个root的shell。更要命的是这哥设置仅在启动时激活而在工作过程中无法改变。</p>

<p>Also we need to keep this in mind that when this feature is enabled that means you don’t even need su binary to gain root access. You just need usb debugging to be enabled.</p>

<p>需要了解这个设置打开意味着你不需要su就可以得到root权限。只要usb调试设置打开。</p>

<p>Build.prop inside the ramdisk generally contains this value. In order to check or modify the ramdisk you need to use following procedure.</p>

<p>通常在ramdisk的Build.prop包含这个值。以下方式可以检查或修改：</p>

<pre><code>Location of build.prop : boot.img → ramdisk.cpio.gz → gunzip → un cpio → build.prop
Variable name : ro.secure
Default value in STOCK ROM’s : 1
Default value in cyanogen and others : 0
</code></pre>

<p>If we look at this along with what was discussed in adb shell mode. We have a ready made root user shell which will give me full access to all files, flexibility to push and pull both from just about any level. In not so good hands this simple setting can cause a phone to lose all its important work.</p>

<p>联系我们在adb shell模式的讨论，我们得到了一个现成的root用户shell可以完全控制所有文件。可能导致手机丢失所有的重要数据。</p>

<p><img src="http://anantshri.info/articles/sec_cust/image0061.jpg" alt="image03" /></p>

<h2>Adb shell over wifi：基于wifi的Adb shell</h2>

<p>Another variable which could be set to allow adb shell access. However this time access is over wifi network.</p>

<p>有一个可以打开adb shell的设置。只不过这次是通过wifi网络。</p>

<pre><code>Variable : service.adb.tcp.port = &lt;tcp_port_no&gt;
</code></pre>

<p>To set this variable you can either place it in build.prop or use commandline</p>

<p>可以通过build.prop设置或者使用命令行进行</p>

<pre><code>#setprop service.adb.tcp.port=3355
</code></pre>

<p>This will mark port 3355 on phone to be usable to attach using adb. However in this case you need to restart adb service once.</p>

<p>这个将3355端口设为用来adb连接。在这个例子里，需要重启adb服务。</p>

<p>Combining this with above two settings and you have handed over your cell phone to one and all, while shouting in top of your voice : – PLEASE OWN ME.</p>

<p>结合上述两个设置，你几乎已经将你的手机拱手让人。</p>

<p>Note : this is a hypothetical attack as this is not yet a common habbit.</p>

<p>注：这是假设的攻击情况，因为这不是一个通常的习惯设置。</p>

<h2>System permissions：系统权限</h2>

<p>In Android Devices, system partition is the most important partition which holds all the system critical files, as per general policy this partition is marked as RO i.e. readonly. However a general aftr market practice which is observed is to mark system partition as rw. The general use case is that by putting system in rw mode it is easy to work on modification of system data. The most harmful setting is if your ROM maker marks system with 777 i.e. rwx or read write execute permission for all users.</p>

<p>在android设备中，system分区是最重要的，包含了所有重要的系统文件，基于常规这个分区是只读的。然后定制过程常常把它设为可读写以便操作和修改系统数据。最恐怖的是做ROM的人把system设置为777即允许所有人读、写、执行。</p>

<p><img src="http://anantshri.info/articles/sec_cust/image006.jpg" alt="image04" /></p>

<p>When a system is marked with write permission it will allow a user to update / modify content of /system partition. Some of the crucial folders include /system/app or /system/bin.</p>

<p>This permission is an open invitation to rootkits, malware, viruses and all simmilar items to start manhandling the device.</p>

<p>Example in below scenario if some app gains root access they can modify any file in /system. However another variation is 777 for /system which effectively allows the whole world to modify the content.</p>

<p>当system被设有写权限将允许更新修改/system分区，包括关键的/system/app或/system/bin。</p>

<p>这个权限直接导致roorkit、恶意软件、病毒等类似东东恶意控制设备。</p>

<p>图例中，如果应用获得root权限他们可以修改/system下任何文件。而/system设置成777意味着所有人可以修改内容。</p>

<h2>Installation from unknown source：来自未知源的安装</h2>

<p>This specific setting is a security issue in itself. This check allows a user to install softwares which are not part of android market.</p>

<p>Note : for users who don’t have access to android market this is the only way to install application. Example large number of chinese android installation doesn’t allow android market.</p>

<p>这个设置本身就是个安全问题。选中后允许用户安装非官方市场的软件。</p>

<p>注：对没有访问官方市场权限的用户来说，这是安装应用的唯一方法。比如大量的中国android安装不允许官方市场。</p>

<p>This setting is available in android machine in following place
这个设置在如下位置：</p>

<pre><code>Menu → Settings → Applications
</code></pre>

<p><img src="http://anantshri.info/articles/sec_cust/image008.jpg" alt="image05" /></p>

<p>General Practice in after market forums is to keep this check enabled allowing users to install and experiment with after market applications. In other places people are instructed to check this box to allow automated tools to install applications however they wont tell users to unckeck after automatic task is done.</p>

<p>讨论定制的论坛常要求打开这个选项以便安装和体验各类引用。另一些情况，用户被要求打开这个设置以便自动安装应用，但是他们不会告诉用户安装后关闭这个选项。</p>

<h2>Su acccess and settings：Su访问和设置</h2>

<p>Rooting of android phone is generally associated with installing su binary. This binary allows a user for shifting the user to root. This is accoumpanied with superuser.apk which acts as a control agent.</p>

<p>android的root通常伴随su工具的安装。这个工具允许普通用户转变称root。这其中也伴随安装superuser.apk来作为控制代理。</p>

<p>However there can be multiple scenarios’s which need to be throughly examined.</p>

<ol>
<li>Su binary installed and superuser.apk installed</li>
<li>Su binary installed but superuser.apk missing.</li>
<li>Su missing but superuser.apk installed</li>
<li>Su and superuser.apk both missing.</li>
</ol>


<p>Case 1 denotes max protection possible.</p>

<p>Case 2 is a critical case as superuser.apk is the governing control over su binary and if its not there then su could be called directly without fear of user pormpt.</p>

<p>多种情况需要检查：</p>

<ol>
<li>su工具安装，superuser.apk也安装</li>
<li>su工具安装，superuser.apk未安装</li>
<li>su工具未安装，superuser.apk安装</li>
<li>su和 superuser.apk均未安装</li>
</ol>


<p>第一种情况提供了最大保护。</p>

<p>第二种情况最要名，因为superuser.apk是su的管理控制，如果不存在的话su就可以被直接随意调用了。</p>

<p><img src="http://anantshri.info/articles/sec_cust/image010.jpg" alt="image06" /></p>

<h2>Custom Recoveries：定制恢复</h2>

<p>All Custom ROMs are generally embedded with one or the other form of custom recovery. These recovery softwares provides you with large amount of options including but not limited to</p>

<ul>
<li>Factory Reset</li>
<li>Partitioning</li>
<li>Backup and Restore</li>
<li>Install / modify parts of internal storage (/system /data etc)</li>
<li>Adb shell in root mode</li>
</ul>


<p>所有定制ROM都集成了某个定制的recovery工具。这个recovery软件提供大量选项包含但不限于：</p>

<ul>
<li>恢复出厂设置</li>
<li>分区</li>
<li>备份恢复</li>
<li>安装修改内部存储（/system /data 等）</li>
<li>root模式的adb shell</li>
</ul>


<p>Below we have screenshots of two different kind of recoveries.</p>

<p>如下，是两个不同的recovery程序的截屏。</p>

<p><img src="http://anantshri.info/articles/sec_cust/image012.jpg" alt="image07" />
<img src="http://anantshri.info/articles/sec_cust/image014.jpg" alt="image08" /></p>

<p>The highlighted portions are the risk’s associated with custom Recoveries. And could potentially lead to device compromise.</p>

<p>高亮部分是recovery程序风险较大的，可能导致设备挂掉。</p>

<p>Another risk associated with the recoveries is that none of the recoveries at this point implement any security feature. There is no password protection or internal check. Launching recovery is as simple as reboot device and repeatedly press back button or vol down key.</p>

<p>另一个风险是recovery程序目前都没有安全特性。比如没有密码保护或者内部检查。调用恢复程序简单到只需要在重启手机时同时按back键或者减小音量键。</p>

<p>Note : considering the experimental nature of custom recoveries password protection could be a lesser priority feature as of now.</p>

<p>注：考虑在recovery程序中加入密码保护等在目前是一个很低优先级的需求。</p>

<h1>PoC Code：PoC代码</h1>

<p>Note : The PoC code is not developed into something fully deployable to avoid script kiddy approach.</p>

<pre><code>#!/bin/bash
#this command will wait till a device is attached
adb wait-for-device
#this command will give you the id of the shell user. If 0 then w00t
id=`adb shell id`
#system permissions rwx
sys_perm=`adb shell ls -l -d /system`
echo id
echo sys_perm
#in case system ro then this will remount to rw
adb remount
#app protector password
adb pull /data/data/com.ruimaninfo.approtect/shared_prefs/  com.ruimaninfo.approtect_preferences.xml
#google authenticator.
adb pull /data/data/com.android.apps.authenticator/databases/databases.db
adb pull /data/data/com.andrid.providers.settings/databases/settings.db
adb pull /data/data/com.providers.contacts/databases/contacts2.db
adb pull /data/data/com.providers.telephony/databases/mmssms.db
adb pull /data/data/com.providers.telephony/databases/telephony.db
adb pull /data/data/com.google.android.apps.plus/databases/

# or you can go directly in attack mode.
# inject payload
adb push malware.apk /system/apps/friendly.apk

# create backup
adb pull /data/data
</code></pre>

<h1>Protection：保护</h1>

<h2>General User：普通用户</h2>

<p>With rooting comes great responsibility, you can’t just roam around and do stuff without giving a heed to the underlying danger. From vary basic stuff a user must keep in mind atleast these basic fundamental security points.</p>

<ul>
<li>USB debugging should be enabled only when its required.</li>
<li>Consider your Phone as your Credit Card and protect it in same manner.</li>
<li>Avoid handing over your phone to unknown or not so trusty person’s.</li>
</ul>


<p>root意味着巨大的责任，你不能只是用的爽快而不去关心潜在的风险。最起码一个用户必须了解基本的安全要点：</p>

<ul>
<li>USB调试只在需要时才被打开</li>
<li>把电话当作信用卡一样保护</li>
<li>避免把电话交给不认识或者不信任的人</li>
</ul>


<h2>Rom Developer：ROM开发者</h2>

<p>Rom Developers need to make sure the setting which require developer intervention are kept in check specially stuff related to ro.secure, /system, superuser.apk and apps installed in /system/app need to be checked by dev’s.</p>

<p>ROM开发者要确保那些需要开发者关注的设置都正确，特别是和ro.secure、/system、superuser.apk以及安装在/system/app的应用等相关的部分。</p>

<p>Developers should encourage dual profile usage one which could be used to testing ROM’s and development work where as other profile which should be the stable one. With most of these settings marked as off.</p>

<p>开发者尽量采用双版本策略，一个用来测试开发，另一个作为稳定版本，其中大部分非安全设置都已经关闭。</p>

<h1>Introduction to Are you Insecure App：介绍Are you Insecure应用</h1>

<p>A simple PoC tool created to show how simple settings could cause dangerous actions. This tool is basically checking 5 of the above described issues and giving out details which are not at secure level and what could be done to secure it.</p>

<p>有个简单的工具可以显示简单的设置可能导致危险动作。这个工具基本上是检查上述5点问题，给出不安全的具体描述以及如何调整设置。</p>

<p>The tool at this point is very crude and would be refined with subsequent updates.</p>

<p>目前这个工具比较原始并将会在未来更新中完善。</p>

<p><img src="http://anantshri.info/articles/sec_cust/image016.jpg" alt="image09" /></p>

<p>Some of the shortcomings at this point :</p>

<ul>
<li>SU and superuser.apk access check is not the best in world.</li>
<li>Can’t check for recovery installed.</li>
</ul>


<p>目前的一些短板：</p>

<ul>
<li>SU和superuser.apk访问检查并不完美</li>
<li>不能检查是否安装了recovery程序</li>
</ul>


<h1>References：参考</h1>

<p><a href="http://android.com">http://android.com</a></p>

<p><a href="http://cyanogenmod.com">http://cyanogenmod.com</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[中英对照] Evernote Architecture – 9 Million Users and 150 Million Requests a Day : Evernote架构-9百万用户和每天1亿5千万请求]]></title>
    <link href="http://lankyzheng.github.com/blog/2011/05/26/evernote-architecture/"/>
    <updated>2011-05-26T07:53:00+00:00</updated>
    <id>http://lankyzheng.github.com/blog/2011/05/26/evernote-architecture</id>
    <content type="html"><![CDATA[<p><img src="http://pic.yupoo.com/lankyzheng/Czi6fplr/kO5Mi.png" title="banner" alt="banner" /></p>

<!--more-->


<p>原文地址：<a href="http://highscalability.com/blog/2011/5/23/evernote-architecture-9-million-users-and-150-million-reques.html">http://highscalability.com/blog/2011/5/23/evernote-architecture-9-million-users-and-150-million-reques.html</a></p>

<p>The folks at Evernote were kind enough to write up an overview of their architecture in a post titled Architectural Digest. Dave Engberg describes their approach to networking, sharding, user storage, search, and some other custom services.</p>

<p>Evernote的那帮哥们挺不错的，写了篇文章叫Architectural Digest来讲他们的架构概况。Dave Engberg描述了他们在网络、shard、用户存储、搜索以及其他定制服务方面的实现。</p>

<p>Evernote is a cool application, partially realizing <a href="http://en.wikipedia.org/wiki/Vannevar_Bush">Vannevar Bush</a>‘s amazing vision of a <a href="http://en.wikipedia.org/wiki/Memex">memex</a>. Wikipedia describes Evernote’s features succinctly:</p>

<p>Evernote是个很酷的应用，部分实现了Vannevar Bush关于memex的美好设想。维基百科上简洁的描述了Evernote的特征：（wiki的废话偶就不翻译了。）</p>

<blockquote><p>Evernote is a suite of software and services designed for notetaking and archiving. A “note” can be a piece of formattable text, a full webpage or webpage excerpt, a photograph, a voice memo, or a handwritten “ink” note. Notes can also have file attachments. Notes can then be sorted into folders, tagged, annotated, edited, given comments, and searched. Evernote supports a number of operating system platforms (including Android, Mac OS X, iOS, Microsoft Windows and WebOS), and also offers online synchronization and backup services.</p></blockquote>

<p>Key here is that Evernote stores a lot of data, that must be searched, and synced through their cloud to any device you use.</p>

<p>关键在于Evernote存储了大量的数据，还要能被搜索，还要能在各种设备上同步使用。</p>

<p>Another key is the effect of Evernote’s business model and cost structure. Evernote is notable for their pioneering of the freemium model, based on the idea from their CEO: The easiest way to get 1 million people paying is to get 1 billion people using. Evernote is designed to become profitable at a 1% conversion rate. The free online service limits users to a hefty 60 MB/month while premium users pay $45 per year for 1,000 MB/month. To be profitable they most store a lot of data without spending a lot of money. There’s not a lot of room for extras, which accounts for the simple practicality of their architecture.</p>

<p>另一个关键在于Evernote的商业模式和成本结构的影响。Evernote因freemium模式的领先而著称，来源于他们CEO的点子：“让1百万人付费最简单的办法是让10亿人使用”。Evernote被设计为靠1%的转化率来盈利。免费的在线服务限制用户60MB/月，要是每年付45美刀则获得1,000MB/月。为了赢利他们尽可能省钱的存储尽可能多的数据。没啥多余花哨的东西，构成了他们简单使用的架构。</p>

<p>The article is short and succinct, so definitely read it for details. Some takeaways:</p>

<p>文章短而简洁，尽可详细阅读。要点如下：</p>

<ul>
<li><p><strong>Controlling costs.</strong> Evernote runs out of a pair of dedicated cages in a data center in Santa Clara, California. Using a cloud wouldn’t provide enough processing power and storage at a cheap enough cost to make Evernote’s business model work. As their load doesn’t appear to be spiky, using their own colo site makes a lot of sense, especially given how they make use of VMs for reliability.</p></li>
<li><p><strong>控制成本。</strong> Evernote在加州成对部署独立服务器。要是用云计算的话，不一定能以足够低的成本提供足够的助理能力和存储来让他的商业模式奏效。由于他们的负载不猛，用他们自己的的组合就挺靠谱了，特别是用了虚拟机来的达到可靠性。</p></li>
<li><p><strong>Architecture based on the nature of the data.</strong> User notes are independent of each other, which makes it very practical for Evernote to shard their 9.5 million total users across 90 shards. Each shard is a pair of two quad-core Intel  SuperMicro boxes with lots RAM and a full chassis of Seagate enterprise drives in mirrored RAID configurations. All storage and API processing is handled by a shard. They’ve found using directly attached storage to have the best price/performance ratio. Using a remote storage tier, with the same level of redundancy, would cost substantially more. Adding drives to a server and replicating with DRDB is low both in overhead and costs.</p></li>
<li><p><strong>基于数据本质设计架构。</strong>用户的notes数据彼此独立，因此Evernote用90个shard来分担9百多万用户的办法就很实用了。每个shard有2个4核处理器，居多内存和做了镜像RAID的满配Seagate企业级硬盘。所有的储存和API处理都在shard内部处理。他们发现直接用硬盘存储性价比很好。要是用专门的存储设备达到相同的冗余级别，成本要高得多。在服务器上价格硬盘以及用DRDB做迁移，成本和日常费用都很低。</p></li>
<li><p><strong>Application redundancy.</strong> Each box runs two VMs. A primary VM runs the core stack: Debian + Java 6 + Tomcat + Hibernate + Ehcache +  Stripes + GWT + MySQL (for metadata) + hierarchical local file systems (for file data). DRDB is used to replication a primary VM to a secondary VM on another box. Heartbeat is used to fail over to a secondary VM is the primary VM dies. A smart way to use those powerful machines and make a reliable system with fewer resources.</p></li>
<li><p><strong>应用冗余。</strong>每个服务器跑2个虚拟机。主虚拟机跑核心应用。DRDB用来做主虚拟机和另一个服务器上的备虚拟机的复制。Heartbeat用来做fail over切换。确实是利用服务器能力以及用较少的资源建立可靠系统的聪明方式。</p></li>
<li><p><strong>Data reliability.</strong> User data is stored on four different enterprise drives across two different physical servers. Nightly backups  copies data over a dedicated 1Gbps link to a secondary data center.</p></li>
<li><p><strong>数据可靠性。</strong>用户数据存在2台物理机的至少4个磁盘上。每天夜间还有跨数据中心的数据复制。</p></li>
<li><p><strong>Fast request routing.</strong> User account information–username, MD5 password, and user shard ID–is stored in an in-memory MySQL database. Reliability comes from RAID mirroring, DRBD replication to a secondary, and nightly backups. This approach makes the routing of users to their data a simple and fast in-memory lookup, while still being highly available.</p></li>
<li><p><strong>快速的请求路由。</strong>用户账号信息存储在内存中的MySQL。RAID、DRBD迁移和夜间备份带来了可靠性。通过内存检索，用户可以快速到达他们的数据，同时保持了高可用性。</p></li>
<li><p>A separate pool of 28 8-core servers process images for search, handwriting recognition, and other services. This is custom software and is a powerful value-add that is not easily replicated by anyone else.</p></li>
<li><p>单独的28台8和服务器处理图片搜索，手写识别等服务。定制软件以及强大的附加值不容易被他人山寨。</p></li>
<li><p>Puppet is used for configuration management.</p></li>
<li><p>Puppet用来做配置管理。</p></li>
<li><p>Monitoring is done with Zabbix, Opsview, and AlertSite.</p></li>
<li><p>监控用了Zabbix, Opsview, 和AlertSite。</p></li>
</ul>


<p>There’s a promise of future articles focusing more on individual subsystems. I look forward to these as you have to appreciate the elegance of the system they’ve created for their business model. A good example to learn from.</p>

<p>他们承诺继续写文章描述各个子系统。偶很期待，并膜拜对他们为自己的商业模式创造出如此优雅的系统。值得学习的范例！</p>

<h6>EOF</h6>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[中英对照]A Digest of Evernote’s Architecture：Evernote架构概要]]></title>
    <link href="http://lankyzheng.github.com/blog/2011/05/25/a-digest-of-evernotes-architecture/"/>
    <updated>2011-05-25T07:41:00+00:00</updated>
    <id>http://lankyzheng.github.com/blog/2011/05/25/a-digest-of-evernotes-architecture</id>
    <content type="html"><![CDATA[<p><img src="http://pic.yupoo.com/lankyzheng/Czi4gbZz/11DByW.png" title="banner" alt="banner" /></p>

<!--more-->


<p>原文地址：<a href="http://blog.evernote.com/tech/2011/05/17/architectural-digest/">http://blog.evernote.com/tech/2011/05/17/architectural-digest/</a></p>

<p>Let’s get things started with a coarse-grained overview of the physical makeup of the Evernote service. I won’t go into a lot of detail on each component here; we’ll aim to talk about the interesting bits in separate posts later.</p>

<p>咱们先从Evernote服务物理构成的初步概况开始。偶不会深入到各个部分的细节中去；偶们计划将来另开新帖来讨论有意思的要点。</p>

<p><img src="http://blog.evernote.com/tech/files/2011/05/evernote-highlevel-architecture1-282x300.png" alt="image01" /></p>

<p>Starting at the top-left corner of the diagram, all stats as of May 17th, 2011 …</p>

<p>从图中左上角开始，所有状态都是2011年5月17日的。。。</p>

<p><strong>Networking:</strong> Virtually all traffic to and from Evernote comes to www.evernote.com via HTTPS port 443. This includes all “web” activity, but also all client synchronization via our <a href="http://thrift.apache.org/">Thrift</a>-based <a href="https://www.evernote.com/about/developer/api/">service API</a>.  Altogether, that produces up to 150 million HTTPS requests per day, with peak traffic around 250 Mbps. (Unfortunately for our semi-nocturnal Operations team, this daily peak tends to arrive around 6:30 am, Pacific time.)</p>

<p><strong>网络：</strong> 实际上到www.evernote.com进出Evernote的所有流量都是走HTTPS的443端口的。包括了所有web活动，也包括所有通过我们基于Thrift的API的客户端同步。总共产生每天一亿五千万次HTTPS请求，峰值流量大约250Mbps。（对我们夜猫子运维团队而言，不幸的是峰值总在太平洋时间早上6:30左右出现。）</p>

<p>We use BGP to direct traffic through fully independent network feeds from our primary (NTT) and secondary (Level 3) providers. This is filtered through Vyatta on the way to the new A10 load balancers that we deployed in January when we hit the limit of SSL performance for our old balancers. We’re comfortably handling existing traffic using one AX 2500 plus a failover box, but we’re preparing to test their N+1 configuration in our staging cluster to prepare for future growth.</p>

<p>偶们使用BGP引导流量通过完全独立的由NTT和Level 3提供的网络。图中由Vyatta过滤之后到达A10负载均衡设备，这玩意偶们一月份才部署因为当时偶们达到了老负载均衡设备的SSL性能限制。目前偶们用1台AX 2500加上一个容灾设备就很淡定的处理了现存的流量，不过偶们准备在分级集群上测试一下他们的N+1配置以应对将来的扩容。</p>

<p><strong>Shards:</strong> The core of the Evernote service is a farm of servers that we call “shards.”  Each shard handles all data and all traffic (web and API) for a cohort of 100,000 registered Evernote users.  Since we have more than 9 million users, this translates into around 90 shards.</p>

<p><strong>Shards：</strong> 咱Evernote服务的核心是一组叫做shards的服务器群。每个shard处理以100,000注册用户为一组的所有数据和流量（web和API）。由于偶们有9百万注册用户，所以差不多有90个shards。</p>

<p>Physically, shards are deployed as a pair a SuperMicro boxes with two quad-core Intel processors, a ton of RAM and full chassis of Seagate enterprise drives in mirrored RAID configurations. On top of each box, we run a base Debian host that manages two Xen virtual machines. The primary VM on a box runs our core application stack:  Debian + Java 6 + Tomcat + Hibernate + Ehcache +  Stripes + GWT + MySQL (for metadata) + hierarchical local file systems (for file data).</p>

<p>物理上看，shards用成对的SuperMicro服务器部署，包括2个四核intel处理器、暴多的内存以及做了镜像RAID的满配的Seagate企业级硬盘。每个服务器上，偶们在Debian基础上开2个Xen虚拟机。第一个主虚拟机跑一堆核心应用：Debian + Java 6 + Tomcat + Hibernate + Ehcache + Stripes + GWT + MySQL (用于metadata) + 分层的本地文件系统 (用户文件数据).</p>

<p>All user data on the primary VM on one box is kept synchronously replicated to a secondary VM on a different box using <a href="http://www.drbd.org/">DRBD</a>. This means that each byte of user data is on at least four different enterprise drives across two different physical servers, plus nightly backups. If we have any problems with a server, we can fail the services from its primary VM over to the secondary on another box with minimal downtime via Heartbeat.</p>

<p>每台服务器上的主虚拟机上的所有用户数据用BRBD同步复制到另一台服务器上的第二个备虚拟机。也就是说每个字节的用户数据位于2台服务器上至少4个不同的企业级磁盘上，外加每天夜间备份。如果某个服务器有问题，偶们通过Heartbeat可以在最小的停机时间内把它的主虚拟机迁移到另一台服务器的备虚拟机上。</p>

<p>Since each users’ data is completely localized to one (virtual) shard host, we can run each shard as an independent island with virtually no crosstalk or dependencies. This means that issues on one shard don’t snowball to other shards.</p>

<p>由于每份用户数据都完全定位于一台（虚拟的）shard上，我们可以没有干扰没有依赖的独立运行每个shard“孤岛”。这表示任何一个shard上的问题，不会波及其他任何shards。</p>

<p>To connect users with their shard, we push most of the work into the load balancers, which have a cascade of rules to find the shard in the URL and/or cookies.</p>

<p>为了把用户连接到他们所在的shard，偶们折腾了很多经历在负载均衡设备上，弄了一堆级联的规则以根据URL和/或cookies来定位shard。</p>

<p><strong>UserStore:</strong> While the vast majority of all data is stored within the single-tier NoteStore shards, they all share a single master “UserStore” account database (also MySQL) with a small amount of information about each account, such as: username, MD5 password, and user shard ID. This database is small enough to fit in RAM, but we maintain high redundancy with the same combination of RAID mirroring, DRBD replication to a secondary, and nightly backups.</p>

<p><strong>UserStore:</strong> 虽然绝大多数用户数据存储在单级的NoteStore shard上，但是他们都共享一个单独的主UserStore账户数据库（也是MySQL）上面存了关于每个账户的少量信息，比如：用户名、MD5后的密码、以及用户的共享ID。这个数据库足够小到能放进内存里面，但是我们还是用上面提到的RAID镜像组合、虚拟机BRBD主从复制以及每天夜间备份等方式了保持了高度的冗余。</p>

<p><strong>AIR processors:</strong> In order to allow you to search for words found within images in your notes, we maintain a pool of 28 servers that spend each day using their 8 cores to process new images. On a busy day, this translates into 1.3 or 1.4 million separate images. Currently, these use a mix of Linux and Windows, but we plan to convert them all to Debian by the end of the month now that we’ve removed some pesky legacy dependencies.</p>

<p><strong>AIR处理器：</strong> 为了让你能搜索从你的notes里面图片上找到的词语，我们维护了一组28台服务器成天用他们的8核处理器处理新的图片。赶上忙的日子，差不多有1千3-4百万张独立的图片。目前，这里面极有linux也有windows，不过偶们现在计划这个月底把他们全换成Debian以摆脱这些讨厌的之前遗留下来的依赖问题。</p>

<p>These servers run a pipeline of “Advanced Imaging and Recognition” (AIR) software developed by our R&amp;D team. This software cleans up each image, identifies word-shaped regions, and then attempts to compile a weighted list of possible matches for each word using a set of “recognition engines” that each contribute a set of guesses.  This includes engines developed by our own team which specialize in, for example, handwriting recognition, as well as licensed technologies from best-of-breed commercial partners.</p>

<p>这些服务器跑一套由我们研发组开发的“Advanced Imaging and Recognition” (AIR)软件。这软件先清理每张图片，识别文字型的区域，然后用一组“识别引擎”编制可能匹配的权重列表来全力“猜”出每个单词。这些引擎既包括了由偶们自己团队研发的专门的针对，例如手写识别的引擎，也包括其他牛逼的商业伙伴的授权技术。</p>

<p><strong>Other services:</strong> All of these servers are racked in a pair of dedicated cages at our data center in Santa Clara, California. In addition to the hardware that provides our core service, we also have smaller groups of servers for lighter-weight tasks that only require one or two boxes or Xen virtual machines. For example, our “incoming email” SMTP gateway is a pair of Debian servers with Postfix and a custom Java mail processor built on top of Dwarf. Our @myen Twitter gateway is a simple in-house daemon using twitter4j.</p>

<p><strong>其他服务：</strong> 所有的服务器都用成对的专用外壳上架在位于加州Santa Clara的数据中心。除了这些提供核心服务的设备之外，我们也有一些更小的服务器组，用来应对只需要1-2台服务器或者Xen虚拟机的轻量级任务。例如，我们“incoming email”的SMTP网关是一对装了Postfix和基于Dward定制的Java邮件处理程序的Debian服务器。偶们的@myen Twitter 网关是个简单的基于twitter4j的内部守护进程。</p>

<p>Our corporate web site is Apache, our blogs are WordPress, most of our fully redundant internal switching topology is from HP, we use Puppet for configuration management, and we monitor with <a href="http://www.zabbix.com/">Zabbix</a>, <a href="http://www.opsview.com/">Opsview</a>, and <a href="http://www.alertsite.com/">AlertSite</a>. We run nightly backups with a combination of different software that migrates data over a dedicated 1Gbps link to a secondary data center.</p>

<p>偶们的官网用的Apache，偶们的博客用的WordPress，大多数全冗余的内部交换拓扑网络来自HP，我们用Puppet做配置管理，我们用Zabbix、Opsview还有AlertSite来做监控。我们用一组不同软件组合来跑每日夜间备份，把数据通过一条专用的1Gbps链路迁移到另一个数据中心。</p>

<p><strong>Wait, but why?</strong> I realize this post leaves lots of obvious questions about why we’ve chosen to do X instead of Y in a number of different places. Why run our own servers instead of using a cloud provider? Why such stuffy old software (Java, SQL, local storage, etc.) instead of hot new magic bullets? …</p>

<p><strong>稍等，为啥这样呢？</strong> 偶知道这个帖子肯定会带来很多明显的问题，关于在各个地方为啥用X方案而不用Y方案。为啥偶们用自己的服务器而不是云服务提供商？为啥用这些老旧的软件(Java, SQL, 本地存储等等)而不是那些流行的新鲜玩意？</p>

<p>We’ll try to get into more details to answer these questions in the next few months.</p>

<p>偶们争取在未来几个月来更详尽的解答这些问题。</p>

<h6>EOF</h6>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[vi cheat sheet]]></title>
    <link href="http://lankyzheng.github.com/blog/2011/05/24/vi-cheat/"/>
    <updated>2011-05-24T03:36:00+00:00</updated>
    <id>http://lankyzheng.github.com/blog/2011/05/24/vi-cheat</id>
    <content type="html"><![CDATA[<p><img src="http://pic.yupoo.com/lankyzheng/CzibVCiQ/lLkgu.png" title="banner" alt="banner" /></p>

<!--more-->


<blockquote><p>每一个做Linux SA的同学都需要一份vi cheat sheet，打印出来贴在床头吧！</p></blockquote>

<p><img src="http://lankyzheng.github.com/images/vi-cheat.png" title="Title here" alt="Smaller icon" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[中英对照]Troubleshooting response time problems – why you cannot trust your system metrics：诊断响应时间问题 – 为啥你不能相信系统指标]]></title>
    <link href="http://lankyzheng.github.com/blog/2011/05/18/troubleshooting-response-time-problems/"/>
    <updated>2011-05-18T07:10:00+00:00</updated>
    <id>http://lankyzheng.github.com/blog/2011/05/18/troubleshooting-response-time-problems</id>
    <content type="html"><![CDATA[<p><img src="http://pic.yupoo.com/lankyzheng/Czi9urZ2/b3FpL.jpg" title="banner" alt="banner" /></p>

<!--more-->


<p>原文地址：<a href="http://highscalability.com/blog/2011/5/11/troubleshooting-response-time-problems-why-you-cannot-trust.html">http://highscalability.com/blog/2011/5/11/troubleshooting-response-time-problems-why-you-cannot-trust.html
</a></p>

<p><a href="http://www.dynatrace.com/en/production-edition.aspx">Production Monitoring</a> is about ensuring the stability and health of our system, that also includes the application. A lot of times we encounter production systems that concentrate on System Monitoring, under the assumption that a stable system leads to stable and healthy applications. So let’s see what System Monitoring can tell us about our <a href="http://www.dynatrace.com/en/pe-advance-application-monitoring.aspx">Application</a>.</p>

<p><a href="http://www.dynatrace.com/en/production-edition.aspx">生产系统监控</a>是为了确保系统以及应用的稳定性和健康。无数次偶们碰到只关注于系统监控的生产系统，并认为稳定的系统就能带来稳定健康的应用。那就看看看系统监控能告诉偶们哪些关于<a href="http://www.dynatrace.com/en/pe-advance-application-monitoring.aspx">应用</a>的信息吧。</p>

<p>Let’s take a very simple two tier Web Application:</p>

<p>偶们先看非常简单的两层Web应用：</p>

<p><img src="http://blog.dynatrace.com/wp-content/tier-600x158.png" alt="image01" /></p>

<p>This is a simple multi-tier eCommerce solution. Users are concerned about bad performance when they do a search. Let’s see what we can find out about it if performance is not satisfactory. We start by looking at a couple of simple metrics.</p>

<p>介是个简单的多层电子商务解决方案。用户为搜索的性能之烂感到郁闷。让偶们瞧瞧性能不行是咋回事。偶们就从查看最简单的指标开始吧。</p>

<h1>CPU Utilization：CPU利用率</h1>

<p>The best known operating system metric is CPU utilization, but it is also the most misunderstood. This metric tells us how much time the CPU spent executing code in the last interval and how much more it could execute theoretically. Like all other utilization measures it tells us something about the capacity, but not about health, stability or even performance. Simply put: 99% CPU utilization can either be optimal or indicate impeding disaster depending on the application.</p>

<p>操作系统最知名的指标就是CPU利用率了，但又是最容易误读的。介个指标说明了在最后一个周期内CPU花了多少时间执行代码，以及理论上还能执行多少。就像其他利用率指标一下，介个体现了一种能力，但是无关健康、稳定性乃至性能。简而言之，根据应用状况，99%的CPU利用率可能是跑的很优化的状态，也可能是崩溃边缘。</p>

<p><img src="http://blog.dynatrace.com/wp-content/host-overview1-600x94.png" alt="image02" /></p>

<p>The CPU charts show no shortage on either tier</p>

<p>（图上显示）前端和后端的CPU都不吃紧。</p>

<p>Let’s look at our setup. We see that the CPU utilization is well below 100%, so we do have capacity left. But does that mean the machine or the application can be considered healthy? Let’s look at another measure that is better suited for the job, the Load Average  (System\Processor QueueLength on Windows ). The Load Average tells us how many threads or processes are currently executed or waiting to get CPU time.</p>

<p>再瞧偶们的设置。我们看到CPU利用率远低于100%，有富余的能力。但是这说明系统或者应用跑的很健康嘛？让偶们来看另一个更合适判断的指标，Load Average (System\Processor QueueLength on Windows)。平均负载(Load Average)告诉我们有多少线程或者进程正在被执行或者正在等待CPU。</p>

<pre><code>Unix Top Output: load average: 1.31, 1.13, 1.10

Unix上就看top命令输出：load average: 1.31, 1.13, 1.10
</code></pre>

<p>Linux systems display three sliding load averages for the last one, five and 15 minutes. The output above shows that in the last minute there were on average 1.3 processes that needed a CPU core at the same time.</p>

<p>Linux系统显示3个变化的平均负载，即当前的、5分钟的和15分钟的。上面的输出显示最后一分钟，平均有超过1.3个进程需要CPU的1个核来同时处理。</p>

<p>If the Load Average is higher than the number of cores in the system we should either see near 100% CPU utilization, or the system has to wait for other resources and cannot max out the CPU. Examples would be Swapping or other I/O related tasks. So the Load Average tells us if we should trust the CPU usage on the one hand and if the machine is overloaded on the other. It does not tell us how well the application itself is performing, but whether the shortage of CPU might impact it negatively. If we do notice a problem we can identify the application that is causing the issue, but not why it is causing it.</p>

<p>如果平均负载高于系统CPU核的数目，要么出现将近100%的CPU利用率，要么系统不得不等待其他资源而无法用足CPU。例如Swap交换或者其他I/O相关的任务。所以平均负载一方面告诉我们是否能相信CPU使用率，另一方面判断机器是否过载。尽管这并不表示应用本身运行的好不好，但是CPU的吃紧会严重影响应用。这种情况能定位到应用，但是并不知道为啥引起的。</p>

<p>In our case we see that neither the load average nor the CPU usage shines any light on our performance issue. If it were to show high CPU utilization or a high load average we could assume that the shortage in CPU is a problem, but we could not be certain.</p>

<p>这里看出，无论CPU利用率还是平均负载都不完全说明问题。如果出现高CPU利用率或者高平均负载，偶们可以认为CPU吃紧，但也不能完全确认。</p>

<h1>Memory Usage：内存占用</h1>

<p>Used memory is monitored because the lack of memory will lead to system instability. An important fact to note is that Unix and Linux operating systems will most always show close to 100% memory utilization over time. They fill the memory up with buffers and caches which get discarded, as opposed to swapped out, if that memory is needed otherwise. In order to get the “real” memory usage we need subtract these. In Linux we can do by using the free command.</p>

<p>偶们监控内存占用是因为内存缺少会导致系统不稳定。需要注意的一点是Unix/Linux系统总是显示将近100%的内存占用。</p>

<p><img src="http://blog.dynatrace.com/wp-content/memory-600x158.png" alt="image03" /></p>

<p>Memory Usage on the two systems, neither is suffering memory problems</p>

<p>(偶们这里例子里)两个系统的内存占用木有一个有问题的。</p>

<p>If we do not have enough memory we can try to identify which application consumes the most by looking at the resident memory usage of a process. Once identified we will have to use other means to identify why the process uses up the memory and whether this is ok. When we look towards memory regarding Java/.NET performance we have to make sure that the application itself is never swapped out. This is especially important because Java accesses all its memory in a random-access fashion and if a portion were to be swapped out it would have serve performance penalties. We can monitor this via swapping measures on the process itself. So what we can learn here is whether the shortage of memory has a negative impact on application performance. As this is not the case, we are tempted to ignore memory as the issue.</p>

<p>如果内存不足，就要查看进程的内存使用来定位哪个应用占了最多。一旦定位，需要用其他方式来确认为啥用了这么多，以及是否合理。针对Java/.NET的时候，必须要确保应用本身木有被交换出去。这一点很重要，因为Java采用随机访问的方式使用内存，如果有部分被交换出去了，会导致性能严重异常。这点可以监控进程的swap交换来获知。这里学到的是，需要判断内存缺失与否对应用性能的影响。在本例里面，内存问题忽略。</p>

<p>We could look at other measures like network or disk, but in all cases the same thing would be true, the shortage of a resource might have impact, but we cannot say for sure. And if we don’t find a shortage it does not necessarily mean that everything is fine.</p>

<p>还需要检查其他指标例如网络或者磁盘，但是原则是一样的，资源的短缺可能影响，但是不能武断。另外，如果没有发现资源短缺，也不表示一切都很好。</p>

<h1>Database：数据库</h1>

<p>An especially good example of this problem is the database. Very often the database is considered the source of all performance problems, at least by the application people. From a DBA’s and operations point of view the database is often running fine though. Their reasoning is simple enough, the database is not running out of any resources, there are no especially long running or CPU consuming statements or processes running and most statements execute quite fast. So the database can not be the problem.</p>

<p>数据库是个很好的例子。通常数据库被认为是所有性能问题的根源，至少应用维护人员是这么认为的。但是从DBA以及运营角度看，数据库其实通常都跑到挺好的。他们的理由很简单，数据库并没有耗尽任何资源啊，木有长时间运行或者耗CPU的语句和进程啦，大多数语句都跑的飞快啦。所以数据库木有问题啦。</p>

<p>Let’s look at this from an application point of view</p>

<p>让偶们从应用的角度来瞧瞧</p>

<h1>Looking at the Application：着眼应用</h1>

<p>As users are reporting performance problems the first thing that we do is to look at the response time and its distribution within our system.</p>

<p>当碰到性能问题，首先需要检查响应时间，及其在系统内部的分布。</p>

<p><img src="http://blog.dynatrace.com/wp-content/overall-600x218.png" alt="image04" /></p>

<p>The overall distribution in our system does not show any particular bottleneck</p>

<p>整体的响应分布，并无体现任何瓶颈。</p>

<p>At first glance we don’t see anything particularly interesting when looking at the whole system. As users are complaining about specific requests lets go ahead and look at these in particular:</p>

<p>一开始光看整个系统，看不出啥特别的。不过用户总是抱怨某些特定的查询，所以咱们来看看这些。</p>

<p><img src="http://blog.dynatrace.com/wp-content/search-flow1-600x142.png" alt="image05" /></p>

<p>The response time distribution of the specific request shows a bottleneck in the backend and a lot of database calls for each and every search request</p>

<p>这个特定查询的响应时间分布，可以看出在后端的一个瓶颈，每个搜索请求引起了大量的数据库调用。</p>

<p>We see that the majority of the response time lies in the backend and the database layer. That the database contributes a major portion to the response time does not mean however that the DBA was wrong. We see that every single search executes 416 statements on average! That means that every statement is executing in under one millisecond and this is fast enough from the database point of view. The problem really lies within the application and its usage of the database. Let’s look at the backend next.</p>

<p>大部分的响应时间发生在后端数据库层。数据库占据了大部分响应时间，并不意味着DBA犯错了。可以看到平均每个搜索执行了416个语句！这说明每个语句都在1ms内执行，从数据库的角度看足够快了。问题真正在于应用对数据库的使用方法。偶们继续看后端。</p>

<p><img src="http://blog.dynatrace.com/wp-content/JVM-600x181.png" alt="image06" /></p>

<p>The Heap Usage and GC activity chart shows a lot of GC runs, but does it have negative impact?</p>

<p>堆(Heap)使用和回收活动(GC)图显示有大量回收跟踪任务在跑，这玩意有负面影响不？</p>

<p>Looking at the JVM we immediately see that it does execute a lot of garbage collection(the red spikes), as you would probably see in every monitoring tool. Although this gives us a strong suspicion, we do not know how this is affecting our users. So let’s look at that impact:</p>

<p>观测JVM马上发现确实执行了大量的GC回收(红色图钉表示)，这情形在所有监控工具都很常见。尽快可以进行强烈怀疑，但是并不知道究竟怎么影响到用户。所以来看看影响：</p>

<p><img src="http://blog.dynatrace.com/wp-content/suspensions-600x184.png" alt="image07" /></p>

<p>These are the runtime suspensions that directly impact the search. It is considerable but still amounts to only 10% of the response time</p>

<p>有很多运行是挂起直接影响到了搜索。尽管可以理解，但毕竟占据了10%的响应时间。</p>

<p>A single transaction is hit by garbage collection several times and if we do the math we find out that garbage collection contributes 10% to the response time. While that is considerable it would not have made sense to spend a lot of time on tuning it just now. Even if we get it down to half it would only have saved us 5% of the response time. So while monitoring garbage collection is important, we should always analyze the impact before we jump to conclusions.</p>

<p>单个事务会被回收任务命中好几次，我们算一下会发现回收任务占据了10%的响应时间。然而这是合理的，要是目前花时间去调优这个就太不靠谱了。哪怕减掉一半仍然会占5%的响应时间。尽管监控回收进程是重要滴，偶们在做结论前仍然需要分析影响。</p>

<p>So let’s take a deeper look at where that particular transaction is spending time on the backend. To do this we need to have application centric monitoring in place which we can then use to isolate the root cause.</p>

<p>再深入看看后端哪有特定的事务耗费了时间。做到这个，需要有个应用集中监控，用来分离出根本原因。</p>

<p><img src="http://blog.dynatrace.com/wp-content/path-details1-600x207.png" alt="image08" /></p>

<p>The detailed response time distribution of the search within the backend shows two main problems: too many EJB calls and a very slow doPost method</p>

<p>后端对于搜索的明细的响应时间分析体现了两个主要问题：太多的EJB以及太慢的doPost方法。</p>

<p>With the right measure points within our application we immediately see the root causes of the response time problem. At first we see that the WebService call done by the search takes up a large portion of the response time. It is also the largest CPU hotspot within that call. So while the host is not suffering CPU problems, we are in fact consuming a lot of it in that particular transaction. Secondly we see that an awful lot of EJB calls are done which in turn leads to the many database calls that we have already noticed.</p>

<p>通过在应用内部设置合理的测量点，能够迅速发现响应时间问题的根本原因。首先我们发现搜索形成的WebService调用占据了大部分响应时间。这也是调用内部最大的CPU热点。所以尽管CPU不忙，但实际上那些特定的事务还是过多的消耗了CPU。其次，我们发现极大量的EJB调用，轮番导致了我们已经注意到的大量数据库调用。</p>

<p>That means we have identified a small memory-related issue; although there are no memory problems noticeable if we were to look only at system monitoring. We also found that we have a CPU hotspot, but the machine itself does not have a CPU problem. And finally we found that the biggest issue is squarely within the application; too many database and EJB calls, which we cannot see on a system monitoring level at all.</p>

<p>这说明我们定位了一个很小的内存问题，尽管我们从系统监控看不出内存问题。我们还发现了一个CPU热点，但是机器本身没有CPU问题。最终我们发现最大的问题果然在应用内部；太多的数据库以及EJB调用，而这些偶们从胸膛那个监控层压根就看不出来。</p>

<h1>Conclusion：结论</h1>

<p>System metrics do a very good job at describing the environment, after all that is what they are meant for. If the environment itself has resource shortages we can almost assume that this has a negative impact on the applications, but we cannot be sure. If there is no obvious shortage this does not, however, imply that the application is running smoothly. A healthy and stable environment does not guarantee a healthy, stable and performing application.</p>

<p>系统指标用来描述系统环境非常有用，毕竟这是他们设计使然。如果环境本身出现资源短缺我们能立即推断会对应用有负面影响，尽管不能确定。然而，即使没有出现明显的资源短缺，也不意味着应用跑的很爽！一个健康且稳定的环境不保证一个健康、稳定和性能良好的应用。</p>

<p>Similar to the system, the application needs to be monitored in detail and with application-specific metrics in order to ensure its health and stability. There is no universal rule as to what these metrics are, but they should enable us to describe the health, stability and performance of the application itself.</p>

<p>与系统类似，应用需要用针对应用的指标来被详细的监控，以确保监控和稳定。尽管究竟使用那些指标没有通用的标准，但这些标准需要能够描述应用本身的健康度、稳定性和性能。</p>

<h6>EOF</h6>
]]></content>
  </entry>
  
</feed>
